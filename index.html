<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OFSP Regeneration Calculator</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js" integrity="sha384-vsrfeLOOY6KuIYKDlmVH5UiBmgIdB1oEf7p01YgWHuqmOHfZr374+odEv96n9tNC" crossorigin="anonymous"></script>
</head>
<body>

    <header>
        <div class="header-content">
            <h1>OFSP Regeneration Calculator</h1>
            <p class="header-subtitle">Orange-Fleshed Sweet Potato Production & Nutrition Model</p>
            <div class="header-description">
                <p>This tool models the multi-generational multiplication of Orange-Fleshed Sweet Potatoes (OFSP) — a biofortified crop rich in Vitamin A — to project harvest yields, feeding capacity, nutritional impact, and costs over successive planting cycles.</p>
                <details class="header-details">
                    <summary>How it works</summary>
                    <div class="header-how-it-works">
                        <div class="how-step">
                            <strong>1. Configure inputs</strong> — Set your starting slips, land area, survival rates, and cost assumptions. Defaults are tuned for northern Haiti rainfed conditions.
                        </div>
                        <div class="how-step">
                            <strong>2. Run the simulation</strong> — The model calculates 12 sub-generations across 3 main planting cycles, including vine-cutting propagation between harvests.
                        </div>
                        <div class="how-step">
                            <strong>3. Analyze results</strong> — View total metric tons harvested, person-days of food, Vitamin A child-days supplied, and per-hectare costs. Compare scenarios side-by-side.
                        </div>
                    </div>
                </details>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <form id="calc-form" class="input-column" novalidate>

                <fieldset id="scenarios-fieldset">
                    <legend>Scenarios</legend>
                    <div class="scenario-controls">
                        <div class="scenario-save-row">
                            <input type="text" id="scenario-name" placeholder="Scenario name...">
                            <button type="button" id="btn-save-scenario">Save</button>
                        </div>
                        <div class="scenario-load-row">
                            <select id="scenario-select">
                                <option value="">-- Load a scenario --</option>
                            </select>
                            <button type="button" id="btn-load-scenario">Load</button>
                            <button type="button" id="btn-delete-scenario">Delete</button>
                        </div>
                        <div class="scenario-compare-row">
                            <select id="compare-a">
                                <option value="">-- Scenario A --</option>
                            </select>
                            <select id="compare-b">
                                <option value="">-- Scenario B --</option>
                            </select>
                            <button type="button" id="btn-compare">Compare</button>
                        </div>
                    </div>
                </fieldset>

                <div id="comparison-container" style="display:none;"></div>

                <fieldset>
                    <legend>Key Model Inputs</legend>
                    <div class="yield-mode-toggle">
                        <span class="yield-mode-label">Yield calculation mode:</span>
                        <label class="radio-label"><input type="radio" name="yield_mode" value="per_hectare" checked> Yield per Hectare <span class="tooltip-icon" data-tooltip="Use tons/ha as the primary yield driver. Potato counts are derived backward from tonnage. This matches how agronomists typically think about yield.">i</span></label>
                        <label class="radio-label"><input type="radio" name="yield_mode" value="per_plant"> Per Plant <span class="tooltip-icon" data-tooltip="Calculate tonnage from individual plant output (slips x potatoes/plant x grams). Use this when you know plant-level productivity.">i</span></label>
                    </div>
                    <div class="form-grid">
                        <label for="initial_slips">Initial Slips <span class="tooltip-icon" data-tooltip="Number of vine slips planted in Generation 1. Typical range: 100,000 - 5,000,000.">i</span></label>
                        <input type="number" id="initial_slips" value="1200000" min="1" required>

                        <label for="initial_hectares">Initial Hectares (Gen 1) <span class="tooltip-icon" data-tooltip="Land area for Generation 1 planting. Typical range: 1 - 500 hectares.">i</span></label>
                        <input type="number" step="0.1" id="initial_hectares" value="34.3" min="0.1" required>

                        <label for="hectares_gen_2">Hectares (Gen 2) <span class="tooltip-icon" data-tooltip="Land area for Generation 2. Usually larger than Gen 1 as more slips become available.">i</span></label>
                        <input type="number" step="0.1" id="hectares_gen_2" value="78.37" min="0.1" required>

                        <label for="hectares_gen_3">Hectares (Gen 3) <span class="tooltip-icon" data-tooltip="Land area for Generation 3. Typically the largest planting area.">i</span></label>
                        <input type="number" step="0.1" id="hectares_gen_3" value="895.71" min="0.1" required>

                        <label for="tons_per_hectare">Tons per Hectare (Yield) <span class="tooltip-icon" data-tooltip="Expected yield in metric tons per hectare. Moderate smallholder with improved varieties: 5-20 t/ha. Default 10 for northern Haiti rainfed conditions.">i</span></label>
                        <input type="number" step="0.1" id="tons_per_hectare" value="10" min="0.1" required>

                        <label for="tons_harvest_percent">Harvest % for Tonnage <span class="tooltip-icon" data-tooltip="Fraction of total production that is harvestable. 0.90 = 90% harvest efficiency. Range: 0.01 - 1.0.">i</span></label>
                        <input type="number" step="0.01" id="tons_harvest_percent" value="0.90" min="0.01" max="1" required>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Growing Season</legend>
                    <div class="form-grid">
                        <label for="cycles_per_year">Crop Cycles per Year <span class="tooltip-icon" data-tooltip="Number of complete crop cycles per year. Northern Haiti supports 2 cycles: April-August and September-January.">i</span></label>
                        <input type="number" id="cycles_per_year" value="2" min="1" max="4" required>

                        <label for="days_to_harvest">Days to Harvest <span class="tooltip-icon" data-tooltip="Number of days from planting to harvest for one cycle. OFSP typically matures in 90-150 days.">i</span></label>
                        <input type="number" id="days_to_harvest" value="120" min="30" max="365" required>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Regeneration & Survival Rates</legend>
                    <div class="form-grid">
                        <label for="potatoes_per_plant">Potatoes per Plant <span class="tooltip-icon" data-tooltip="Average number of tubers each plant produces. Tropical avg 4-8.">i</span></label>
                        <input type="number" id="potatoes_per_plant" value="5" min="1" required>

                        <label for="vine_cuttings_per_plant">Vine Cuttings (per plant) <span class="tooltip-icon" data-tooltip="Number of vine cuttings taken from each surviving plant for sub-generations (1a, 1b, 1c, etc.). CIP data: 5-8 per harvest.">i</span></label>
                        <input type="number" id="vine_cuttings_per_plant" value="5" min="1" required>

                        <label for="replant_percent">Tuber Replant % (for next Gen) <span class="tooltip-icon" data-tooltip="Fraction of harvested tubers set aside for replanting. 0.10 = 10%. Range: 0.01 - 1.0.">i</span></label>
                        <input type="number" step="0.01" id="replant_percent" value="0.10" min="0.01" max="1" required>

                        <label for="slips_from_replant">Slips from Replanted Tuber <span class="tooltip-icon" data-tooltip="Number of slips each sprouted replanted tuber produces. Research shows 20-50 slips per sprouted tuber.">i</span></label>
                        <input type="number" id="slips_from_replant" value="30" min="1" required>

                        <label for="slip_survival_rate">Slip Survival Rate <span class="tooltip-icon" data-tooltip="Fraction of planted slips that survive to harvest. 0.70 = 70% survive. Haiti: storms, drought, pests reduce survival. Range: 0.01 - 1.0.">i</span></label>
                        <input type="number" step="0.01" id="slip_survival_rate" value="0.70" min="0.01" max="1" required>

                        <label for="crop_survival_rate">Crop Survival Rate <span class="tooltip-icon" data-tooltip="Fraction surviving crop damage (weevil Cylas formicarius, weather). 0.70 = 70% survives. Range: 0.01 - 1.0.">i</span></label>
                        <input type="number" step="0.01" id="crop_survival_rate" value="0.70" min="0.01" max="1" required>

                        <label for="storage_survival_rate">Storage Survival Rate <span class="tooltip-icon" data-tooltip="Fraction surviving post-harvest storage. 0.65 = 65% survives. 35% post-harvest loss typical in Haiti (no cold chain). Range: 0.01 - 1.0.">i</span></label>
                        <input type="number" step="0.01" id="storage_survival_rate" value="0.65" min="0.01" max="1" required>
                    </div>
                </fieldset>
                
                <fieldset>
                    <legend>Nutrition & Logistics</legend>
                    <div class="form-grid">
                        <label for="people_to_feed">People to Feed <span class="tooltip-icon" data-tooltip="Target population to provide nutrition for. Used to calculate days of food supply.">i</span></label>
                        <input type="number" id="people_to_feed" value="1000000" min="1" required>

                        <label for="calorie_target_per_person">Calorie Target (per person/day) <span class="tooltip-icon" data-tooltip="Daily calorie gap per person from OFSP. 600 kcal is the IPC gap estimate for Phase 3+ households. Range: 100 - 3000.">i</span></label>
                        <input type="number" id="calorie_target_per_person" value="600" min="1" required>

                        <label for="calories_per_potato_with_leaves">Calories (Potato + Leaves) <span class="tooltip-icon" data-tooltip="Calories from one average tuber. 86 kcal/100g at 175g avg = ~150 kcal. Leaves counted separately.">i</span></label>
                        <input type="number" id="calories_per_potato_with_leaves" value="150" min="1" required>

                        <label for="grams_per_potato">Grams per Potato (avg) <span class="tooltip-icon" data-tooltip="Average weight of one tuber in grams. OFSP avg 130-250g in tropics. Default 175g for northern Haiti.">i</span></label>
                        <input type="number" id="grams_per_potato" value="175" min="1" required>

                        <label for="grams_per_ton">Grams per Metric Ton <span class="tooltip-icon" data-tooltip="Conversion factor: grams in one metric ton. 1,000,000g = 1 metric ton.">i</span></label>
                        <input type="number" id="grams_per_ton" value="1000000" min="1" required>

                        <label for="vitamin_a_per_100g">Vitamin A per 100g (mcg RAE) <span class="tooltip-icon" data-tooltip="Beta-carotene content of OFSP expressed as mcg Retinol Activity Equivalents per 100g flesh. OFSP range: 250-1300 mcg RAE. Default 700 for typical improved varieties.">i</span></label>
                        <input type="number" id="vitamin_a_per_100g" value="700" min="0" required>

                        <label for="daily_vitamin_a_need">Daily Vitamin A Need (mcg RAE) <span class="tooltip-icon" data-tooltip="WHO Recommended Daily Allowance for Vitamin A. Default 400 mcg RAE (children aged 1-3). Adults: 600-900 mcg RAE.">i</span></label>
                        <input type="number" id="daily_vitamin_a_need" value="400" min="1" required>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>Cost Inputs (per Hectare)</legend>
                    <div class="form-grid">
                        <label for="acres_per_hectare">Acres per Hectare <span class="tooltip-icon" data-tooltip="Conversion factor: 1 hectare = 2.47105 acres. Usually not changed.">i</span></label>
                        <input type="number" step="0.00001" id="acres_per_hectare" value="2.47105" min="0.01" required>

                        <label for="cost_irrigation_per_acre">Irrigation ($ / Acre) <span class="tooltip-icon" data-tooltip="Cost of irrigation per acre. Northern Haiti is rainfed (>92% of ag), so default is 0.">i</span></label>
                        <input type="number" id="cost_irrigation_per_acre" value="0" min="0" required>

                        <label for="cost_slip_per_unit">Cost per Slip ($) <span class="tooltip-icon" data-tooltip="Purchase price per vine cutting. Only applied to Generation 1. Locally produced vine cuttings in Haiti.">i</span></label>
                        <input type="number" step="0.01" id="cost_slip_per_unit" value="0.05" min="0" required>

                        <label for="cost_land_clearing_per_acre">Labor: Land Clearing ($ / Acre) <span class="tooltip-icon" data-tooltip="Labor cost to clear land per acre. Haiti labor ~$3-5/day.">i</span></label>
                        <input type="number" id="cost_land_clearing_per_acre" value="40" min="0" required>

                        <label for="cost_forking_per_acre">Labor: Forking ($ / Acre) <span class="tooltip-icon" data-tooltip="Labor cost for soil preparation (forking/tilling) per acre.">i</span></label>
                        <input type="number" id="cost_forking_per_acre" value="60" min="0" required>

                        <label for="cost_planting_per_acre">Labor: Planting ($ / Acre) <span class="tooltip-icon" data-tooltip="Labor cost for planting slips per acre.">i</span></label>
                        <input type="number" id="cost_planting_per_acre" value="45" min="0" required>

                        <label for="cost_weeding_per_acre">Labor: Weeding ($ / Acre) <span class="tooltip-icon" data-tooltip="Labor cost for weeding per acre over the growth cycle.">i</span></label>
                        <input type="number" id="cost_weeding_per_acre" value="90" min="0" required>

                        <label for="cost_fertilizer_app_per_acre">Labor: Fertilizer App ($ / Acre) <span class="tooltip-icon" data-tooltip="Labor cost for applying fertilizer per acre.">i</span></label>
                        <input type="number" id="cost_fertilizer_app_per_acre" value="15" min="0" required>

                        <label for="cost_harvesting_per_acre">Labor: Harvesting ($ / Acre) <span class="tooltip-icon" data-tooltip="Labor cost for harvesting per acre.">i</span></label>
                        <input type="number" id="cost_harvesting_per_acre" value="45" min="0" required>

                        <label for="cost_herbicide_per_acre">Supplies: Herbicide ($ / Acre) <span class="tooltip-icon" data-tooltip="Cost of herbicide supplies per acre.">i</span></label>
                        <input type="number" id="cost_herbicide_per_acre" value="30" min="0" required>

                        <label for="cost_fertilizer_per_acre">Supplies: Fertilizer ($ / Acre) <span class="tooltip-icon" data-tooltip="Cost of fertilizer supplies per acre.">i</span></label>
                        <input type="number" id="cost_fertilizer_per_acre" value="50" min="0" required>

                        <label for="cost_tools_per_acre">Supplies: Tools ($ / Acre) <span class="tooltip-icon" data-tooltip="Cost of tools and equipment per acre.">i</span></label>
                        <input type="number" id="cost_tools_per_acre" value="40" min="0" required>

                        <label for="cost_other_per_acre">Supplies: Other ($ / Acre) <span class="tooltip-icon" data-tooltip="Miscellaneous supply costs per acre.">i</span></label>
                        <input type="number" id="cost_other_per_acre" value="20" min="0" required>

                        <label for="cost_transport_per_acre">Supplies: Transport ($ / Acre) <span class="tooltip-icon" data-tooltip="Transportation cost per acre for moving inputs and harvest.">i</span></label>
                        <input type="number" id="cost_transport_per_acre" value="35" min="0" required>
                    </div>
                </fieldset>

                <button type="submit">Run Simulation</button>
            </form>

            <div id="results-container" class="results-column">
                <div class="placeholder">
                    <p>Adjust the values in the form and click "Run Simulation" to see the results.</p>
                </div>
            </div>
        </div>

        <div id="timeline-section" class="chart-section" style="display: none;">
            <div class="chart-header">
                <h2>Growing Season Timeline</h2>
            </div>
            <canvas id="timeline-chart"></canvas>
        </div>

        <div id="chart-section" class="chart-section" style="display: none;">
            <div class="chart-header">
                <h2>Generation Comparison</h2>
                <div class="chart-toggle">
                    <button type="button" class="toggle-btn active" data-metric="tons_harvested">Tons Harvested</button>
                    <button type="button" class="toggle-btn" data-metric="days_fed">Days Fed</button>
                    <button type="button" class="toggle-btn" data-metric="cost">Cost ($)</button>
                    <button type="button" class="toggle-btn" data-metric="vitamin_a">VA Child-Days</button>
                </div>
            </div>
            <canvas id="gen-chart"></canvas>
        </div>
    </main>

    <footer class="site-footer">
        <div class="footer-content">
            <p class="footer-attribution">Model by Tim Maurer and <a href="https://github.com/NJHFinanceHub" target="_blank" rel="noopener">NJH Finance Hub</a></p>
            <p class="footer-context">Defaults tuned for northern Haiti rainfed OFSP cultivation. OFSP varieties currently under evaluation by CIP and Quisqueya University.</p>
            <p class="footer-sources">Data sources: <a href="https://cipotato.org/" target="_blank" rel="noopener">CIP</a>, <a href="https://www.fao.org/" target="_blank" rel="noopener">FAO</a>, <a href="https://www.usaid.gov/" target="_blank" rel="noopener">USAID</a>, <a href="https://www.harvestplus.org/" target="_blank" rel="noopener">HarvestPlus</a>, <a href="https://www.wfp.org/" target="_blank" rel="noopener">WFP</a></p>
            <p class="footer-repo"><a href="https://github.com/NJHFinanceHub/OFSP_Calculator" target="_blank" rel="noopener">View on GitHub</a></p>
        </div>
    </footer>

    <script src="app.js"></script>
</body>
</html>